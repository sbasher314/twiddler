<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="dataGenerator.js"></script>

    <style>
      body {
        font-family: "Verdana", sans-serif;
        margin: 0!important;
        padding: 0;
      }
      nav.navBar {
        width: 100vw;
        height: 5rem;
        background: hsl(210,50%,50%);
        position: fixed;
        display: flex;
        flex-direction: row;
        justify-content: center;
        top: 0;
        z-index: 100;
        box-shadow: 2px 0 4px black;
        color:white;
        font-size: 2em;
      }
      span.twiddlerHeader {
        align-self: center;
      }
      .tweetStream {
        position:absolute;
        width:100vw; height:calc(100vh - 5em);
        margin:0; padding:4px;
        overflow-y: auto;
        overflow-x: hidden;
        margin-right: 8px;
        display: flex;
        flex-direction: column;
        box-sizing: border-box;
        margin-top: 5em;
      }
      .tweetPane {
        background: #e9e9e9;
        border-radius: 8px;
        margin: 4px;
        padding: 8px;
        box-shadow: 1px 1px 2px #999;
        position: relative;
        min-height: 64px;
        max-height:25vh;
      }

      .tweetPane:nth-child(odd) {
        background: #eee;
      }
      .tweetBody {
        margin: 8px;
      }
      a.tweetAuthor {
        font-weight: bold;
        margin-right: 4px;
        color: hsla(200,100%,40%,0.95);
        cursor: pointer;
      }
      span.tweetTimestamp {
        color: #666;
      }
    </style>

  </head>
  <body>
    <script>

      $(document).ready(function(){
        var $body = $('body');
        $body.html('');
        $body.append("<nav class='navBar'><span class='twiddlerHeader'>Twiddler</span></nav");
        var $tweetStream = $('<div class="tweetStream"></div>').appendTo($body);
        updateTweets();

        function updateTweets() {
          streams.home.currentIndex = streams.home.currentIndex || 0;
          var newItems = streams.home.length - streams.home.currentIndex;
          var offsetIndex = 0;
          for(var i = streams.home.currentIndex; i < streams.home.length; i++) {
            streams.home.currentIndex = i;
            var tweet = streams.home[i];
            var $tweet = $('<div class="tweetPane" time="'+ tweet.created_at +'"></div>');
            $('<span class="tweetHeader"><a class = "tweetAuthor">@' + tweet.user + '</a><span class="tweetTimestamp">' + generateTimeAgo(tweet.created_at) +'</span></span>').appendTo($tweet); // Tweet Header
            $('<div class = "tweetBody">' + tweet.message + '</div>').appendTo($tweet);
            $tweet.prependTo($tweetStream).hide();
            $tweet.css({"display":"none", opacity:0, "margin-left":"5px", "min-height":"0em", "flex-basis":"0%"}).delay(offsetIndex * (2500 / newItems)).show(200 / newItems).animate({"display":"inline-block", opacity:1, "margin-left":"0", "min-height":"8em","flex-basis":"100%"});
            offsetIndex++;
          }
          updateTimestamps();
          setTimeout(updateTweets, 10000);
        }

        function updateTimestamps() {
          $(".tweetPane").each(function(a) {
            tweetedTime = generateTimeAgo(this.attributes.time.value);
            $(this).find(".tweetTimestamp").text(tweetedTime);
          });
        }


        function generateTimeAgo(timestamp) {
          var time = new Date(timestamp);
          var currentTime = new Date();
          var secs = Math.floor((currentTime.getTime() - time.getTime()) / 1000); //gets difference between publishing time and current time in seconds
          var mins = Math.floor(secs / 60);
          var hours = Math.floor(secs / 3600);
          var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
          var date = time.getDate();
          var month = months[time.getMonth()];
          var year = time.getFullYear();
          if(secs < 5) {
            return 'Right now';
          }
          if(secs < 60 ) {
            return secs + ' seconds ago';
          }
          if (mins < 60) {
            return mins + ' minute' + ((mins > 1) ? 's' : '') + ' ago';
          }
          if (hours < 24) {
            return hours + ' hour' + ((hours > 1) ? 's' : '') + 'ago';
          }
          if (currentTime.getFullYear() !== year) {
            return month + " " + date + ", " + year;
          }
          return  month + " " + date;
        }
      });
    </script>

  </body>
</html>
